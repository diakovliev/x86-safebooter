#! /usr/bin/python
# -*- coding: utf-8 -*-

import fractions
import gmpy

#----------------------------------
# Key
#----------------------------------

#----------------- DSA params ---------------
G = 0x1CC3F4C4489A78B6D0EF7AF937A205EAA381D7983002A8C26BA9B9C2A220F4BF7153694AD6987494B436D93695179043195F3B6D82A0F8345E53ED685C06271D1D8C39A08E39B3AB30063C3C0D26D29F424DAD51699E921234D86E6CDD615B0DCBE7F5ACD31A81D8463037DFE8B7F66449DFCD5778D6D5D590D014553961D770
P = 0x8656933ED5D51777756788E92A1D174AACC3AA4A8DD015F8885CA10A62421079FD33F14D20E11F6D785B0D7E937490D2DF115EC201AD1A7F6D45761160711D5D18A8A141B99EFE5A00B2A108E8646FFF754F8B67526EA3B199F60083560D4FEFED2F86EF279E1A4509B220913521FB9D3B2C4697165D5BBBE15BF7E02619A9A9
Q = 0x88EE0A61A156961293B8D1FC4A44CBD4288BB5C1
pub = 0x46CC1904314A50BEFCAFA5A568593868C4F53EEABD75D19E417FAF65E1EF5AD8547A90CD067174632C77AF3F9A0EF2E66BEC733830913E7E7F7C3C1FF89AA4481A17353F4DAF9E8E382F7478FC8C44FFBEC31E145C2EF199D32F33749BEC4D4E0133A7BDA085FC6E32611FABD2DE261E0F886812EDE07960303A7819FE051285
priv = 0x013AFD4CE09C2228CCC724BBAC7D2E534ACBE002
sha2 = 0x33842135E0014FEE5E3CD9D2EAA1F295092BFA40
#--------------------------------------------
k = 0x73BB64CDBC5964A6C5281F700137692CE61F6C0C


#----------------------------------
#----------------------------------
def dsa_sign():
  k_inv = gmpy.invert(k,Q)
  print "k_inv: 0x%X" % k_inv
  r = pow(G,k,P)
  r = r % Q
  print "r: 0x%X" % r
  s = (r*priv) % Q
  s = (s + sha2) % Q
  s = (s * k_inv) % Q
  print "s: 0x%X" % s
  return [r,s]
  
def dsa_check(r,s):
  w = gmpy.invert(s,Q)
  print "w: 0x%X" % w
  u1 = (sha2 * w) % Q
  print "u1: 0x%X" % u1
  u2 = (r * w) % Q
  print "u2: 0x%X" % u2
  v = (pow(G,u1,P) * pow(pub,u2,P)) % P % Q
  print "v: 0x%X" % v


#----------------------------------
#----------------------------------
rs = dsa_sign()
dsa_check(rs[0],rs[1])




