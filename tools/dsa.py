#! /usr/bin/python
# -*- coding: utf-8 -*-

import fractions
import gmpy

#----------------------------------
# Key
#----------------------------------


#----------------- DSA params ---------------
G = 0x59846C92C2BB7041293120B6873F4570B072F0D4B232219430F3D8053EDE733B089419678967149E5D64ED39722101BFE85D2DB43CD7E6CEA6D6FDE4C1BB47B7EA0A2AA11769A85ACA0B69ACD5286DE97D31CD85ADC43FF2364A16F197183F0EEDB746B2D261533B193ADBE35CE6AC1A9A7B41FF6BEC1B01778CB30C8E00A473
P = 0xCC91E545B3EF58FD4F2A9F824DC4CF44E65114E53D1273E49A62C6764F53B90B34E54509474570475E311A848BEF229E5ED3D66131F4257FB288BE30B3876D71AFB6B73B62BA74D1E76D3229AC94AA483E9A66B8912D6554B2288E42E0E53286B357AF37B47B023A65BB8777F9E68C1CF3F37B9511530FB28025A58A6EC48F67
Q = 0xDC282480743815B7FE54816C05CD560DB234131F
pub = 0x54918D77628A2B819F00C081B0F501E8F5E6B964A818BD99B5C035837BCF7092A894261931D91A8444100E6FC2C4404118DD5F260BDFE461005018736BBCF9183469557FEDFDC7BF0A303C45BA02F367A724C42653EFD6B2AD963713F8CE1DBEC4313F110CD4F451CBB57087B05DA0547FBC9B8B7146E87264C0B745B82A2C75
priv = 0x05EAB15C9E0A229A6AC449137C79981FBE889BF9
sha2 = 0x3051345A29CA835B33794BAF9ADA05471135B35C
#--------------------------------------------
k = 0xCA88B02CB882C0AEE4127CE80B223C22ECB46C741

#----------------------------------
def dsa_sign():
  k_inv = gmpy.invert(k,Q)
  print "k_inv: 0x%X" % k_inv
  r = pow(G,k,P)
  r = r % Q
  print "r: 0x%X" % r
  s = (r*priv) % Q
  s = (s + sha2) % Q
  s = (s * k_inv) % Q
  print "s: 0x%X" % s
  return [r,s]
  
def dsa_check(r,s):
  w = gmpy.invert(s,Q)
  print "w: 0x%X" % w
  u1 = (sha2 * w) % Q
  print "u1: 0x%X" % u1
  u2 = (r * w) % Q
  print "u2: 0x%X" % u2
  v = (pow(G,u1,P) * pow(pub,u2,P)) % P % Q
  print "v: 0x%X" % v
  return r - v

#----------------------------------
#----------------------------------
rs = dsa_sign()
print "dsa_check: %d" % dsa_check(rs[0],rs[1])

