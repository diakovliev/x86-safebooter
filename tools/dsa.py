#! /usr/bin/python
# -*- coding: utf-8 -*-

import fractions
import gmpy

#----------------------------------
# Key
#----------------------------------

#------------ DSA params ------------
G = 0x8E63DA8BAA9CE628C245F4F0B3A7ED9B7AB83CF4E5F69930AAF0790CDAC7A978DF169B2653FA45DFB8AE01EA2A0ED90C313D30BA0405A820A4AE891B72100054A641FB560949CBC913AF2474FA1A8FBA09749FD783EAFCF9FD4830C682288A51C6DBE35F14D170903A59638D4EC329C0F290AAE3914E9208306C7B7C98311517
P = 0xB9F4B43BFC57033097C3953F0BBA91D2FF77209A2D1BEA7F927E545FE1ACFEBCFF729F20FD5FE60C744E73CBA9DD22DBAA9B3D29EE54C47B065FB27EAA0726BF1336018E555C2BD129A5215508F810144504D4734A779FEB0B8AAA067BDC3F47903C3F565D4E40C8AC169EA7DEBD3CA44731F606A17E0B675AF50D7EFA036447
Q = 0xE7E143B1351C49E07558CA4C1FCE043AC0B1095F
pub = 0xADFAD7CC09423221AE639D1E1EBF94A468A3D56D6B0649BA0A3DF9D544AEEAF10DDF5269C73BE220D03E5294C61F723A8562E44DF2C442476DEB80DD0FB60B223FE13CF9EDBFBF47FDF0455C95F5CA409812B132E51E0DD90EDA9FB0AD0605DE5634A986028B1D6EFF34347D206B497EAEDA1BCA7DDD99A405FE98DDC6441DF7
priv = 0x8111B10676E3828D78B99BB3487DFAB5FDAF67D6
sha2 = 0x9C077AD62E76477412410517F977F60422014986
#------------------------------------
#------------------------------------


#----------------------------------
#----------------------------------
def dsa_sign():
  k_inv = gmpy.invert(k,Q)
  print "k_inv: 0x%X" % k_inv
  r = pow(G,k,P)
  r = r % Q
  print "r: 0x%X" % r
  s = (r*priv) % Q
  s = (s + sha2) % Q
  s = (s * k_inv) % Q
  print "s: 0x%X" % s
  return [r,s]
  
def dsa_check(r,s):
  w = gmpy.invert(s,Q)
  print "w: 0x%X" % w
  u1 = (sha2 * w) % Q
  print "u1: 0x%X" % u1
  u2 = (r * w) % Q
  print "u2: 0x%X" % u2
  v = (pow(G,u1,P) * pow(pub,u2,P)) % P % Q
  print "v: 0x%X" % v


#----------------------------------
#----------------------------------
rs = dsa_sign()
dsa_check(rs[0],rs[1])




